<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>一周学习+锻炼电子日历壁纸</title>
  <style>
    :root{--bg:#0f1115;--panel:#161a22;--soft:#1e2430;--text:#e7e9ee;--muted:#a7b0c0;--accent:#7ab7ff;--accent2:#8ef0c1;--grid:#222733;--shadow:0 10px 30px rgba(0,0,0,.35)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif}
    .wrap{width:100%;height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:14px;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,var(--panel),var(--soft));border-radius:18px;padding:14px 18px;box-shadow:var(--shadow)}
    .clock{display:flex;align-items:baseline;gap:14px}
    .clock .time{font-size:46px;letter-spacing:1px}
    .clock .date{font-size:16px;color:var(--muted)}
    .today-badge{padding:6px 10px;border-radius:999px;background:var(--accent);color:#0a0f14;font-weight:700;box-shadow:0 6px 18px rgba(122,183,255,.35)}

    main{display:grid;grid-template-columns:260px 1fr;gap:14px;min-height:0}
    .side{background:var(--panel);border-radius:18px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px}
    .view-toggle{display:flex;gap:8px}
    .btn{border:none;background:var(--soft);color:var(--text);padding:8px 10px;border-radius:12px;cursor:pointer}
    .btn.active{outline:2px solid var(--accent)}

    .week{display:grid;grid-template-columns:1fr;gap:8px}
    .day{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:12px;background:var(--soft);cursor:pointer}
    .day.active{outline:2px solid var(--accent)}
    .day small{color:var(--muted)}

    .panel{background:var(--panel);border-radius:18px;padding:14px;box-shadow:var(--shadow);min-width:0;display:flex;flex-direction:column;gap:12px}

    .now-row{display:flex;align-items:center;justify-content:space-between;background:var(--soft);border-radius:14px;padding:10px 12px}
    .now-row .bar{--p:0;position:relative;height:8px;background:var(--grid);border-radius:999px;overflow:hidden;flex:1;margin:0 10px}
    .now-row .bar::after{content:"";position:absolute;left:0;top:0;bottom:0;width:calc(var(--p) * 1%);background:linear-gradient(90deg,var(--accent),var(--accent2))}

    .list{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto}
    .item{display:grid;grid-template-columns:96px 1fr auto;gap:12px;align-items:center;background:var(--soft);padding:10px 12px;border-radius:12px}
    .item .time{font-variant-numeric:tabular-nums;color:var(--muted)}
    .item .title{font-weight:600}
    .item .tag{padding:4px 8px;border-radius:999px;font-size:12px;color:#0b1016}
    .tag.cls{background:#ffd166}
    .tag.study{background:#8ef0c1}
    .tag.train{background:#7ab7ff}
    .tag.relax{background:#b39ddb}
    .tag.music{background:#ffb3c1}
    .tag.sleep{background:#90caf9}

    .grid{display:none;gap:8px}
    .grid.active{display:grid}
    .grid{grid-template-columns:repeat(7,1fr)}
    .col{background:var(--panel);border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:8px}
    .col h3{margin:0 0 4px 0;font-size:14px;color:var(--muted)}

    footer{display:flex;align-items:center;justify-content:space-between;color:var(--muted)}
    .hint{opacity:.8}
    .err{background:#3b1e2b;color:#ffd1dc;padding:12px;border-radius:12px;margin:8px 0;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="clock">
        <div class="time" id="time">--:--</div>
        <div class="date" id="date">加载中…</div>
      </div>
      <div class="today-badge" id="todayBadge">今天</div>
    </header>

    <main>
      <aside class="side">
        <div class="view-toggle">
          <button class="btn active" id="btnToday">当天</button>
          <button class="btn" id="btnWeek">整周</button>
        </div>
        <div class="week" id="weekList"></div>
      </aside>

        <section class="panel">
          <div class="now-row">
            <div id="nowLabel">当前：—</div>
            <div class="bar" id="nowBar"></div>
            <div id="nextLabel">下一项：—</div>
          </div>
          <div id="err" class="err"></div>
          <div class="list" id="todayList"></div>
          <div class="grid" id="weekGrid"></div>
        </section>
    </main>

    <footer>
      <div class="hint">Europe/Rome 时区 · 自动高亮今天 / 进度条显示当前时段</div>
      <div>Nova × 无常 · Wallpaper Engine HTML 壁纸</div>
    </footer>
  </div>

  <script>
  (function(){
    'use strict';
    try{
      const TZ = 'Europe/Rome';
      let selectedDay = null; // 当前选中日
      const m = (hm)=>{ const a = hm.split(':').map(Number); return a[0]*60+a[1]; };
      const nowMinutesInTZ = ()=>{
        const f = new Intl.DateTimeFormat('en-GB',{timeZone:TZ,hour12:false,hour:'2-digit',minute:'2-digit'}).format(new Date());
        const x=f.split(':'); return parseInt(x[0],10)*60+parseInt(x[1],10);
      };
      const weekdayInTZ = ()=>{
        const w = new Intl.DateTimeFormat('en-US',{timeZone:TZ,weekday:'short'}).format(new Date());
        return ({Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6})[w];
      };
      const Range=(t1,t2,title,tag)=>({kind:'range',s:m(t1),e:m(t2),title,tag});
      const Point=(t1,title,tag)=>({kind:'point',s:m(t1),e:null,title,tag});
      const tagLabel=(k)=>({cls:'课程',train:'锻炼',study:'自习',relax:'生活',music:'贝斯',sleep:'睡眠',go:'出门',back:'回家'})[k]||k;

      const eveningBlock=[
        Range('19:30','20:30','自习','study'),
        Range('20:30','21:00','贝斯练习（30分钟，注意音量）','music'),
        Range('21:00','22:00','自习','study'),
        Range('22:00','22:30','自由放松','relax'),
        Range('22:30','22:50','洗澡','relax'),
        Range('22:50','23:20','拉伸放松','relax'),
        Point('23:30','睡觉','sleep')
      ];

      const schedule={
        1:[Point('06:30','起床','relax'),Range('07:00','07:40','胸训练（哑铃推举×100）','train'),Range('07:40','08:10','洗澡+早餐','relax'),Range('08:15','10:15','自习①','study'),Range('10:30','12:30','自习②','study'),Range('12:30','13:30','午餐+休息','relax'),Range('13:30','16:00','自习③','study'),Range('16:15','18:00','自习④','study'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock),
        2:[Point('06:30','起床','relax'),Range('07:00','07:45','力量训练（4动作×50）','train'),Range('07:45','08:15','洗澡+早餐','relax'),Range('08:15','12:30','自习','study'),Range('12:30','13:30','午餐','relax'),Range('13:30','13:45','准备出门','go'),Range('13:45','14:00','出门（步行约12分钟）','go'),Range('14:00','16:00','课：Paradigmi di Programmazione A','cls'),Range('16:00','18:00','课：Laboratorio II A','cls'),Range('18:00','18:12','回家（步行约12分钟）','back'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock),
        3:[Point('06:30','起床','relax'),Range('07:00','07:30','轻度激活（拉伸+核心）','train'),Range('07:30','08:00','洗澡+早餐','relax'),Range('08:30','08:45','准备出门','go'),Range('08:45','09:00','出门（步行约12分钟）','go'),Range('09:00','11:00','课：Laboratorio di Programmazione Parallela','cls'),Range('11:00','13:00','课：Ricerca Operativa A','cls'),Range('13:00','13:12','回家（步行约12分钟）','back'),Range('13:12','13:30','午餐','relax'),Range('13:30','13:45','准备出门','go'),Range('13:45','14:00','出门（步行约12分钟）','go'),Range('14:00','16:00','课：Architetture e Sistemi Operativi A','cls'),Range('16:00','18:00','课：Paradigmi di Programmazione A','cls'),Range('18:00','18:12','回家（步行约12分钟）','back'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock),
        4:[Point('06:30','起床','relax'),Range('07:00','07:30','腹部训练','train'),Range('07:30','08:00','洗澡+早餐','relax'),Range('08:30','08:45','准备出门','go'),Range('08:45','09:00','出门（步行约12分钟）','go'),Range('09:00','11:00','课：Laboratorio di Programmazione Parallela','cls'),Range('11:00','12:30','自习/回家路上缓冲','study'),Range('12:30','13:30','午餐','relax'),Range('13:30','13:45','准备出门','go'),Range('13:45','14:00','出门（步行约12分钟）','go'),Range('14:00','16:00','课：Paradigmi di Programmazione A','cls'),Range('16:00','18:00','课：Ricerca Operativa A','cls'),Range('18:00','18:12','回家（步行约12分钟）','back'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock),
        5:[Point('06:30','起床','relax'),Range('07:00','07:40','胸训练（哑铃推举×100）','train'),Range('07:40','08:10','洗澡+早餐','relax'),Range('08:30','08:45','准备出门','go'),Range('08:45','09:00','出门（步行约12分钟）','go'),Range('09:00','11:00','课：Laboratorio II A','cls'),Range('11:00','13:00','课：Architetture e Sistemi Operativi A','cls'),Range('13:00','13:12','回家（步行约12分钟）','back'),Range('13:12','13:30','午餐','relax'),Range('16:00','18:00','自习/复习','study'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock),
        6:[Point('06:30','起床','relax'),Range('07:00','07:30','拉伸/轻有氧','train'),Range('07:30','08:00','洗澡+早餐','relax'),Range('08:00','18:00','自习/项目（自由块）','study'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock),
        0:[Point('06:30','起床','relax'),Range('07:00','07:30','腹部训练','train'),Range('07:30','08:00','洗澡+早餐','relax'),Range('08:00','18:00','自习 + 复习总结（自由块）','study'),Range('18:30','19:30','晚餐','relax')].concat(eveningBlock)
      };

      function fmtHM(mins){ const h=(mins/60|0).toString().padStart(2,'0'); const m0=(mins%60).toString().padStart(2,'0'); return h+":"+m0; }

      function build(){
        const wd = weekdayInTZ();
        if(selectedDay===null) selectedDay = wd; // 首次默认今天
        const nowM = nowMinutesInTZ();
        const list = schedule[selectedDay] || [];

        // 顶部时间
        const nowStr = new Intl.DateTimeFormat('zh-CN',{timeZone:TZ,year:'numeric',month:'long',day:'2-digit',weekday:'long',hour:'2-digit',minute:'2-digit',hour12:false}).format(new Date());
        document.getElementById('date').textContent = nowStr;

        // 今日/所选日列表
        const wrap = document.getElementById('todayList');
        wrap.innerHTML='';
        let currentIdx=-1, nextIdx=-1, progress=0;
        for(let i=0;i<list.length;i++){
          const e=list[i];
          if(e.kind==='range'){
            if(nowM>=e.s && nowM<e.e){ currentIdx=i; progress=((nowM-e.s)/(e.e-e.s))*100; }
            if(nowM<e.s && nextIdx===-1) nextIdx=i;
          }else{
            if(nowM<=e.s && nextIdx===-1) nextIdx=i;
          }
          const row=document.createElement('div');
          row.className='item';
          const timeTxt = e.kind==='range' ? (fmtHM(e.s)+"–"+fmtHM(e.e)) : ("● "+fmtHM(e.s));
          row.innerHTML = '<div class="time">'+timeTxt+'</div>'+
                          '<div class="title">'+e.title+'</div>'+
                          '<div class="tag '+e.tag+'">'+tagLabel(e.tag)+'</div>';
          if(i===currentIdx) row.style.outline='2px solid var(--accent)';
          wrap.appendChild(row);
        }
        const nowBar=document.getElementById('nowBar'); nowBar.style.setProperty('--p', (progress||0).toFixed(2));
        document.getElementById('nowLabel').textContent = currentIdx>-1 ? ('当前：'+list[currentIdx].title) : '当前：空档';
        document.getElementById('nextLabel').textContent = nextIdx>-1 ? ('下一项：'+ (list[nextIdx].kind==='range'?fmtHM(list[nextIdx].s):fmtHM(list[nextIdx].s)) +' · '+list[nextIdx].title) : '下一项：—';

        // 侧栏周列表
        const order=[1,2,3,4,5,6,0];
        const cn=['周日','周一','周二','周三','周四','周五','周六'];
        const wl=document.getElementById('weekList'); wl.innerHTML='';
        order.forEach(function(d){
          const first=(schedule[d]||[])[0];
          const el=document.createElement('div');
          el.className='day'+(d===selectedDay?' active':'');
          el.innerHTML='<div>'+cn[d]+'</div><small>'+(first?(first.kind==='range'?fmtHM(first.s):fmtHM(first.s))+' 开始':'休息')+'</small>';
          el.onclick=function(){
            selectedDay=d;
            document.getElementById('btnToday').classList.add('active');
            document.getElementById('btnWeek').classList.remove('active');
            document.getElementById('weekGrid').classList.remove('active');
            document.getElementById('todayList').style.display='flex';
            build();
          };
          wl.appendChild(el);
        });

        // 整周网格
        const grid=document.getElementById('weekGrid'); grid.innerHTML='';
        order.forEach(function(d){
          const col=document.createElement('div'); col.className='col';
          col.innerHTML='<h3>'+cn[d]+'</h3>';
          (schedule[d]||[]).forEach(function(e){
            const p=document.createElement('div'); p.className='item'; p.style.gridTemplateColumns='auto 1fr auto';
            const timeTxt = e.kind==='range' ? (fmtHM(e.s)+'–'+fmtHM(e.e)) : ('● '+fmtHM(e.s));
            p.innerHTML='<div class="time">'+timeTxt+'</div><div class="title">'+e.title+'</div><div class="tag '+e.tag+'">'+tagLabel(e.tag)+'</div>';
            col.appendChild(p);
          });
          grid.appendChild(col);
        });
      }

      function tick(){
        const t = new Intl.DateTimeFormat('zh-CN',{timeZone:TZ,hour:'2-digit',minute:'2-digit',hour12:false}).format(new Date());
        document.getElementById('time').textContent=t;
      }

      document.getElementById('btnToday').onclick=function(){
        document.getElementById('btnToday').classList.add('active');
        document.getElementById('btnWeek').classList.remove('active');
        document.getElementById('weekGrid').classList.remove('active');
        document.getElementById('todayList').style.display='flex';
        build();
      };
      document.getElementById('btnWeek').onclick=function(){
        document.getElementById('btnWeek').classList.add('active');
        document.getElementById('btnToday').classList.remove('active');
        document.getElementById('weekGrid').classList.add('active');
        document.getElementById('todayList').style.display='none';
        build();
      };

      // 安全初始化
      tick(); build();
      setInterval(function(){ tick(); build(); }, 30000);

    }catch(e){
      var box=document.getElementById('err');
      if(box){ box.style.display='block'; box.textContent='脚本错误：'+e.message; }
      console.error(e);
    }
  })();
  </script>
</body>
</html>

