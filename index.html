<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¸€å‘¨å­¦ä¹ +é”»ç‚¼ç”µå­æ—¥å†å£çº¸</title>
  <style>
    :root{--bg:#0f1115;--panel:#161a22;--soft:#1e2430;--text:#e7e9ee;--muted:#a7b0c0;--accent:#7ab7ff;--accent2:#8ef0c1;--grid:#222733;--shadow:0 10px 30px rgba(0,0,0,.35)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif}
    .wrap{width:100%;height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:14px;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,var(--panel),var(--soft));border-radius:18px;padding:14px 18px;box-shadow:var(--shadow)}
    .clock{display:flex;align-items:baseline;gap:14px}
    .clock .time{font-size:46px;letter-spacing:1px}
    .clock .date{font-size:16px;color:var(--muted)}
    .today-badge{padding:6px 10px;border-radius:999px;background:var(--accent);color:#0a0f14;font-weight:700;box-shadow:0 6px 18px rgba(122,183,255,.35)}

    main{display:grid;grid-template-columns:260px 1fr;gap:14px;min-height:0}
    .side{background:var(--panel);border-radius:18px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px}
    .view-toggle{display:flex;gap:8px}
    .btn{border:none;background:var(--soft);color:var(--text);padding:8px 10px;border-radius:12px;cursor:pointer}
    .btn.active{outline:2px solid var(--accent)}

    .week{display:grid;grid-template-columns:1fr;gap:8px}
    .day{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:12px;background:var(--soft);cursor:pointer}
    .day.active{outline:2px solid var(--accent)}
    .day small{color:var(--muted)}

    .panel{background:var(--panel);border-radius:18px;padding:14px;box-shadow:var(--shadow);min-width:0;display:flex;flex-direction:column;gap:12px}

    .now-row{display:flex;align-items:center;justify-content:space-between;background:var(--soft);border-radius:14px;padding:10px 12px}
    .now-row .bar{--p:0;position:relative;height:8px;background:var(--grid);border-radius:999px;overflow:hidden;flex:1;margin:0 10px}
    .now-row .bar::after{content:"";position:absolute;left:0;top:0;bottom:0;width:calc(var(--p) * 1%);background:linear-gradient(90deg,var(--accent),var(--accent2))}

    .list{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto}
    .item{display:grid;grid-template-columns:96px 1fr auto;gap:12px;align-items:center;background:var(--soft);padding:10px 12px;border-radius:12px}
    .item .time{font-variant-numeric:tabular-nums;color:var(--muted)}
    .item .title{font-weight:600}
    .item .tag{padding:4px 8px;border-radius:999px;font-size:12px;color:#0b1016}
    .tag.cls{background:#ffd166}
    .tag.study{background:#8ef0c1}
    .tag.train{background:#7ab7ff}
    .tag.relax{background:#b39ddb}
    .tag.music{background:#ffb3c1}
    .tag.sleep{background:#90caf9}

    .grid{display:none;gap:8px}
    .grid.active{display:grid}
    .grid{grid-template-columns:repeat(7,1fr)}
    .col{background:var(--panel);border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:8px}
    .col h3{margin:0 0 4px 0;font-size:14px;color:var(--muted)}

    footer{display:flex;align-items:center;justify-content:space-between;color:var(--muted)}
    .hint{opacity:.8}
    .err{background:#3b1e2b;color:#ffd1dc;padding:12px;border-radius:12px;margin:8px 0;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="clock">
        <div class="time" id="time">--:--</div>
        <div class="date" id="date">åŠ è½½ä¸­â€¦</div>
      </div>
      <div class="today-badge" id="todayBadge">ä»Šå¤©</div>
    </header>

    <main>
      <aside class="side">
        <div class="view-toggle">
          <button class="btn active" id="btnToday">å½“å¤©</button>
          <button class="btn" id="btnWeek">æ•´å‘¨</button>
        </div>
        <div class="week" id="weekList"></div>
      </aside>

        <section class="panel">
          <div class="now-row">
            <div id="nowLabel">å½“å‰ï¼šâ€”</div>
            <div class="bar" id="nowBar"></div>
            <div id="nextLabel">ä¸‹ä¸€é¡¹ï¼šâ€”</div>
          </div>
          <div id="err" class="err"></div>
          <div class="list" id="todayList"></div>
          <div class="grid" id="weekGrid"></div>
        </section>
    </main>

    <footer>
      <div class="hint">Europe/Rome æ—¶åŒº Â· è‡ªåŠ¨é«˜äº®ä»Šå¤© / è¿›åº¦æ¡æ˜¾ç¤ºå½“å‰æ—¶æ®µ</div>
      <div>Nova Ã— æ— å¸¸ Â· Wallpaper Engine HTML å£çº¸</div>
    </footer>
  </div>

  <script>
  (function(){
    'use strict';
    try{
      const TZ = 'Europe/Rome';
      let selectedDay = null; // å½“å‰é€‰ä¸­æ—¥
      const m = (hm)=>{ const a = hm.split(':').map(Number); return a[0]*60+a[1]; };
      const nowMinutesInTZ = ()=>{
        const f = new Intl.DateTimeFormat('en-GB',{timeZone:TZ,hour12:false,hour:'2-digit',minute:'2-digit'}).format(new Date());
        const x=f.split(':'); return parseInt(x[0],10)*60+parseInt(x[1],10);
      };
      const weekdayInTZ = ()=>{
        const w = new Intl.DateTimeFormat('en-US',{timeZone:TZ,weekday:'short'}).format(new Date());
        return ({Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6})[w];
      };
      const Range=(t1,t2,title,tag)=>({kind:'range',s:m(t1),e:m(t2),title,tag});
      const Point=(t1,title,tag)=>({kind:'point',s:m(t1),e:null,title,tag});
      const tagLabel=(k)=>({cls:'è¯¾ç¨‹',train:'é”»ç‚¼',study:'è‡ªä¹ ',relax:'ç”Ÿæ´»',music:'è´æ–¯',sleep:'ç¡çœ ',go:'å‡ºé—¨',back:'å›å®¶'})[k]||k;

      const eveningBlock=[
        Range('20:00','20:30','è´æ–¯ç»ƒä¹ ï¼ˆ30åˆ†é’Ÿï¼Œæ³¨æ„éŸ³é‡ï¼‰','music'),
        Range('20:30','22:00','è‡ªä¹ ','study'),
        Range('22:00','22:30','è‡ªç”±æ”¾æ¾','relax'),
        Range('22:30','22:50','æ´—æ¾¡','relax'),
        Range('22:50','23:20','æ‹‰ä¼¸æ”¾æ¾','relax'),
        Point('23:30','ç¡è§‰','sleep')
      ];

      const schedule={
        1:[Point('07:30','èµ·åºŠ','relax'),Range('17:30','18:30','èƒ¸è®­ç»ƒï¼ˆå“‘é“ƒæ¨ä¸¾Ã—100ï¼‰','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:15','10:15','è‡ªä¹ â‘ ','study'),Range('10:30','12:30','è‡ªä¹ â‘¡','study'),Range('12:30','13:30','åˆé¤+ä¼‘æ¯','relax'),Range('13:30','16:00','è‡ªä¹ â‘¢','study'),Range('16:15','17:30','è‡ªä¹ â‘£','study'),Range('18:30','19:30','æ™šé¤','relax')].concat(eveningBlock),
        2:[Point('07:30','èµ·åºŠ','relax'),Range('18:10','19:10','åŠ›é‡è®­ç»ƒï¼ˆ4åŠ¨ä½œÃ—50ï¼‰','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:15','12:30','è‡ªä¹ ','study'),Range('12:30','13:30','åˆé¤','relax'),Range('13:30','13:45','å‡†å¤‡å‡ºé—¨','go'),Range('13:45','14:00','å‡ºé—¨ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','go'),Range('14:00','16:00','è¯¾ï¼šParadigmi di Programmazione A','cls'),Range('16:00','18:00','è¯¾ï¼šLaboratorio II A','cls'),Range('18:00','18:12','å›å®¶ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','back'),Range('19:10','20:00','æ™šé¤','relax')].concat(eveningBlock),
        3:[Point('07:30','èµ·åºŠ','relax'),Range('07:00','07:30','è½»åº¦æ¿€æ´»ï¼ˆæ‹‰ä¼¸+æ ¸å¿ƒï¼‰','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:30','08:45','å‡†å¤‡å‡ºé—¨','go'),Range('08:45','09:00','å‡ºé—¨ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','go'),Range('09:00','11:00','è¯¾ï¼šLaboratorio di Programmazione Parallela','cls'),Range('11:00','13:00','è¯¾ï¼šRicerca Operativa A','cls'),Range('13:00','13:12','å›å®¶ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','back'),Range('13:12','13:30','åˆé¤','relax'),Range('13:30','13:45','å‡†å¤‡å‡ºé—¨','go'),Range('13:45','14:00','å‡ºé—¨ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','go'),Range('14:00','16:00','è¯¾ï¼šArchitetture e Sistemi Operativi A','cls'),Range('16:00','18:00','è¯¾ï¼šParadigmi di Programmazione A','cls'),Range('18:00','18:12','å›å®¶ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','back'),Range('18:30','19:30','æ™šé¤','relax')].concat(eveningBlock),
        4:[Point('07:30','èµ·åºŠ','relax'),Range('18:10','18:40','è…¹éƒ¨è®­ç»ƒ','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:30','08:45','å‡†å¤‡å‡ºé—¨','go'),Range('08:45','09:00','å‡ºé—¨ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','go'),Range('09:00','11:00','è¯¾ï¼šLaboratorio di Programmazione Parallela','cls'),Range('11:00','12:30','è‡ªä¹ /å›å®¶è·¯ä¸Šç¼“å†²','study'),Range('12:30','13:30','åˆé¤','relax'),Range('13:30','13:45','å‡†å¤‡å‡ºé—¨','go'),Range('13:45','14:00','å‡ºé—¨ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','go'),Range('14:00','16:00','è¯¾ï¼šParadigmi di Programmazione A','cls'),Range('16:00','18:00','è¯¾ï¼šRicerca Operativa A','cls'),Range('18:00','18:12','å›å®¶ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','back'),Range('18:40','19:30','æ™šé¤','relax')].concat(eveningBlock),
        5:[Point('07:30','èµ·åºŠ','relax'),Range('17:30','18:30','èƒ¸è®­ç»ƒï¼ˆå“‘é“ƒæ¨ä¸¾Ã—100ï¼‰','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:30','08:45','å‡†å¤‡å‡ºé—¨','go'),Range('08:45','09:00','å‡ºé—¨ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','go'),Range('09:00','11:00','è¯¾ï¼šLaboratorio II A','cls'),Range('11:00','13:00','è¯¾ï¼šArchitetture e Sistemi Operativi A','cls'),Range('13:00','13:12','å›å®¶ï¼ˆæ­¥è¡Œçº¦12åˆ†é’Ÿï¼‰','back'),Range('13:12','13:30','åˆé¤','relax'),Range('16:00','17:30','è‡ªä¹ /å¤ä¹ ','study'),Range('18:30','19:30','æ™šé¤','relax')].concat(eveningBlock),
        6:[Point('07:30','èµ·åºŠ','relax'),Range('17:30','18:00','æ‹‰ä¼¸/è½»æœ‰æ°§','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:00','18:00','è‡ªä¹ /é¡¹ç›®ï¼ˆè‡ªç”±å—ï¼‰','study'),Range('18:30','19:30','æ™šé¤','relax')].concat(eveningBlock),
        0:[Point('07:30','èµ·åºŠ','relax'),Range('18:10','18:40','è…¹éƒ¨è®­ç»ƒ','train'),Range('07:40','08:10','æ´—æ¾¡+æ—©é¤','relax'),Range('08:00','18:00','è‡ªä¹  + å¤ä¹ æ€»ç»“ï¼ˆè‡ªç”±å—ï¼‰','study'),Range('18:30','19:30','æ™šé¤','relax')].concat(eveningBlock)
      };

      function fmtHM(mins){ const h=(mins/60|0).toString().padStart(2,'0'); const m0=(mins%60).toString().padStart(2,'0'); return h+":"+m0; }

      function selfTest(){
        try{
          const days=[0,1,2,3,4,5,6];
          days.forEach(d=>{
            const arr=(schedule[d]||[]);
            arr.forEach((e,i)=>{
              if(e.kind!=='range' && e.kind!=='point') throw new Error(`day ${d} idx ${i} invalid kind`);
              if(typeof e.title!=='string' || typeof e.tag!=='string') throw new Error(`day ${d} idx ${i} bad title/tag`);
              if(typeof e.s!=='number' || e.s<0 || e.s>=1440) throw new Error(`day ${d} idx ${i} bad start`);
              if(e.kind==='range' && (typeof e.e!=='number' || e.e<=e.s || e.e>1440)) throw new Error(`day ${d} idx ${i} bad end`);
            });
          });
          // ok
        }catch(err){
          const box=document.getElementById('err'); if(box){box.style.display='block'; box.textContent='æ•°æ®æ ¡éªŒå¤±è´¥ï¼š'+err.message;}
          throw err;
        }
      }

      function runTests(){
        // é¢å¤–æµ‹è¯•ï¼šæ’åºå•è°ƒæ€§ã€è´æ–¯æ—¶é•¿ã€èµ·åºŠæ—¶é—´ç‚¹
        const days=[0,1,2,3,4,5,6];
        days.forEach(d=>{
          const arr=(schedule[d]||[]).slice().sort((a,b)=>a.s-b.s);
          for(let i=1;i<arr.length;i++){
            console.assert(arr[i].s>=arr[i-1].s, `æ’åºé”™è¯¯: day ${d} idx ${i}`);
          }
        });
        // è´æ–¯ï¼ˆmusicï¼‰åº”ä¸º30åˆ†é’Ÿ
        const all = days.flatMap(d=>schedule[d]||[]);
        all.filter(e=>e.kind==='range' && e.tag==='music').forEach(e=>{
          console.assert((e.e-e.s)===30, 'è´æ–¯æ—¶é•¿åº”è¯¥æ˜¯30åˆ†é’Ÿ');
        });
        // èµ·åºŠåº”ä¸º07:30ï¼ˆPointï¼‰
        days.forEach(d=>{
          const has = (schedule[d]||[]).some(e=>e.kind==='point' && e.title.includes('èµ·åºŠ') && e.s===m('07:30'));
          console.assert(has, `day ${d} ç¼ºå°‘ 07:30 èµ·åºŠ ç‚¹äº‹ä»¶`);
        });
      }

      function build(){
        const wd = weekdayInTZ();
        if(selectedDay===null) selectedDay = wd; // é¦–æ¬¡é»˜è®¤ä»Šå¤©
        const nowM = nowMinutesInTZ();
        const list = schedule[selectedDay] || [];
        const sorted = list.slice().sort((a,b)=>((a && typeof a.s==='number')?a.s:-1) - ((b && typeof b.s==='number')?b.s:-1)); // ğŸ”§ ç»Ÿä¸€æŒ‰å¼€å§‹æ—¶é—´æ’åº

        // é¡¶éƒ¨æ—¶é—´
        const nowStr = new Intl.DateTimeFormat('zh-CN',{timeZone:TZ,year:'numeric',month:'long',day:'2-digit',weekday:'long',hour:'2-digit',minute:'2-digit',hour12:false}).format(new Date());
        document.getElementById('date').textContent = nowStr;

        // ä»Šæ—¥/æ‰€é€‰æ—¥åˆ—è¡¨
        const wrap = document.getElementById('todayList');
        wrap.innerHTML='';
        let currentIdx=-1, nextIdx=-1, progress=0;
        for(let i=0;i<sorted.length;i++){
          const e=sorted[i];
          if(e.kind==='range'){
            if(nowM>=e.s && nowM<e.e){ currentIdx=i; progress=((nowM-e.s)/(e.e-e.s))*100; }
            if(nowM<e.s && nextIdx===-1) nextIdx=i;
          }else{
            if(nowM<=e.s && nextIdx===-1) nextIdx=i;
          }
          const row=document.createElement('div');
          row.className='item';
          const timeTxt = e.kind==='range' ? (fmtHM(e.s)+"â€“"+fmtHM(e.e)) : ("â— "+fmtHM(e.s));
          row.innerHTML = '<div class="time">'+timeTxt+'</div>'+
                          '<div class="title">'+e.title+'</div>'+
                          '<div class="tag '+e.tag+'">'+tagLabel(e.tag)+'</div>';
          if(i===currentIdx) row.style.outline='2px solid var(--accent)';
          wrap.appendChild(row);
        }
        const nowBar=document.getElementById('nowBar'); nowBar.style.setProperty('--p', (progress||0).toFixed(2));
        document.getElementById('nowLabel').textContent = currentIdx>-1 ? ('å½“å‰ï¼š'+sorted[currentIdx].title) : 'å½“å‰ï¼šç©ºæ¡£';
        document.getElementById('nextLabel').textContent = nextIdx>-1 ? ('ä¸‹ä¸€é¡¹ï¼š'+ (sorted[nextIdx].kind==='range'?fmtHM(sorted[nextIdx].s):fmtHM(sorted[nextIdx].s)) +' Â· '+sorted[nextIdx].title) : 'ä¸‹ä¸€é¡¹ï¼šâ€”';

        // ä¾§æ å‘¨åˆ—è¡¨ï¼ˆé¦–é¡¹æ—¶é—´å–æ’åºåç¬¬ä¸€é¡¹ï¼‰
        const order=[1,2,3,4,5,6,0];
        const cn=['å‘¨æ—¥','å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­'];
        const wl=document.getElementById('weekList'); wl.innerHTML='';
        order.forEach(function(d){
          const daySorted = (schedule[d]||[]).slice().sort((a,b)=>a.s-b.s);
          const first=daySorted[0];
          const el=document.createElement('div');
          el.className='day'+(d===selectedDay?' active':'');
          el.innerHTML='<div>'+cn[d]+'</div><small>'+(first?(first.kind==='range'?fmtHM(first.s):fmtHM(first.s))+' å¼€å§‹':'ä¼‘æ¯')+'</small>';
          el.onclick=function(){
            selectedDay=d;
            document.getElementById('btnToday').classList.add('active');
            document.getElementById('btnWeek').classList.remove('active');
            document.getElementById('weekGrid').classList.remove('active');
            document.getElementById('todayList').style.display='flex';
            build();
          };
          wl.appendChild(el);
        });

        // æ•´å‘¨ç½‘æ ¼ï¼ˆæ¯åˆ—æ’åºï¼‰
        const grid=document.getElementById('weekGrid'); grid.innerHTML='';
        order.forEach(function(d){
          const col=document.createElement('div'); col.className='col';
          col.innerHTML='<h3>'+cn[d]+'</h3>';
          const daySorted=(schedule[d]||[]).slice().sort((a,b)=>a.s-b.s);
          daySorted.forEach(function(e){
            const p=document.createElement('div'); p.className='item'; p.style.gridTemplateColumns='auto 1fr auto';
            const timeTxt = e.kind==='range' ? (fmtHM(e.s)+'â€“'+fmtHM(e.e)) : ('â— '+fmtHM(e.s));
            p.innerHTML='<div class="time">'+timeTxt+'</div><div class="title">'+e.title+'</div><div class="tag '+e.tag+'">'+tagLabel(e.tag)+'</div>';
            col.appendChild(p);
          });
          grid.appendChild(col);
        });
      }

      function tick(){
        const t = new Intl.DateTimeFormat('zh-CN',{timeZone:TZ,hour:'2-digit',minute:'2-digit',hour12:false}).format(new Date());
        document.getElementById('time').textContent=t;
      }

      document.getElementById('btnToday').onclick=function(){
        document.getElementById('btnToday').classList.add('active');
        document.getElementById('btnWeek').classList.remove('active');
        document.getElementById('weekGrid').classList.remove('active');
        document.getElementById('todayList').style.display='flex';
        build();
      };
      document.getElementById('btnWeek').onclick=function(){
        document.getElementById('btnWeek').classList.add('active');
        document.getElementById('btnToday').classList.remove('active');
        document.getElementById('weekGrid').classList.add('active');
        document.getElementById('todayList').style.display='none';
        build();
      };

      // å®‰å…¨åˆå§‹åŒ–
      tick(); selfTest(); runTests(); build();
      setInterval(function(){ tick(); build(); }, 30000);

    }catch(e){
      var box=document.getElementById('err');
      if(box){ box.style.display='block'; box.textContent='è„šæœ¬é”™è¯¯ï¼š'+e.message; }
      console.error(e);
    }
  })();
  </script>
</body>
</html>

